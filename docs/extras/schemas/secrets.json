{
  "$id": "https://phalanx.lsst.io/schemas/secrets.json",
  "title": "Phalanx application secret definitions",
  "type": "object",
  "additionalProperties": {
    "$ref": "#/definitions/ConditionalSecretConfig"
  },
  "definitions": {
    "ConditionalSecretCopyRules": {
      "title": "ConditionalSecretCopyRules",
      "description": "Possibly conditional rules for copying a secret value from another.",
      "type": "object",
      "properties": {
        "if": {
          "title": "Condition",
          "description": "Configuration only applies if this Helm chart setting is set to a true value",
          "type": "string"
        },
        "application": {
          "title": "Application",
          "type": "string"
        },
        "key": {
          "title": "Key",
          "type": "string"
        }
      },
      "required": [
        "application",
        "key"
      ],
      "additionalProperties": false
    },
    "ConditionalSimpleSecretGenerateRules": {
      "title": "ConditionalSimpleSecretGenerateRules",
      "description": "Conditional rules for generating a secret value with no source.",
      "type": "object",
      "properties": {
        "if": {
          "title": "Condition",
          "description": "Configuration only applies if this Helm chart setting is set to a true value",
          "type": "string"
        },
        "type": {
          "title": "Type",
          "enum": [
            "password",
            "gafaelfawr-token",
            "fernet-key",
            "rsa-private-key"
          ],
          "type": "string"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    },
    "ConditionalSourceSecretGenerateRules": {
      "title": "ConditionalSourceSecretGenerateRules",
      "description": "Conditional rules for generating a secret from another secret.",
      "type": "object",
      "properties": {
        "if": {
          "title": "Condition",
          "description": "Configuration only applies if this Helm chart setting is set to a true value",
          "type": "string"
        },
        "type": {
          "title": "Type",
          "enum": [
            "bcrypt-password-hash",
            "mtime"
          ],
          "type": "string"
        },
        "source": {
          "title": "Source",
          "type": "string"
        }
      },
      "required": [
        "type",
        "source"
      ]
    },
    "SecretOnepasswordConfig": {
      "title": "SecretOnepasswordConfig",
      "description": "Configuration for how a static secret is stored in 1Password.",
      "type": "object",
      "properties": {
        "encoded": {
          "title": "Encoded",
          "default": false,
          "type": "boolean"
        }
      }
    },
    "ConditionalSecretConfig": {
      "title": "ConditionalSecretConfig",
      "description": "Possibly conditional specification for an application secret.",
      "type": "object",
      "properties": {
        "if": {
          "title": "Condition",
          "description": "Configuration only applies if this Helm chart setting is set to a true value",
          "type": "string"
        },
        "description": {
          "title": "Description",
          "type": "string"
        },
        "copy": {
          "title": "Copy",
          "description": "Rules for where the secret should be copied from",
          "allOf": [
            {
              "$ref": "#/definitions/ConditionalSecretCopyRules"
            }
          ]
        },
        "generate": {
          "title": "Generate",
          "anyOf": [
            {
              "$ref": "#/definitions/ConditionalSimpleSecretGenerateRules"
            },
            {
              "$ref": "#/definitions/ConditionalSourceSecretGenerateRules"
            }
          ]
        },
        "onepassword": {
          "title": "Onepassword",
          "default": {
            "encoded": false
          },
          "allOf": [
            {
              "$ref": "#/definitions/SecretOnepasswordConfig"
            }
          ]
        },
        "value": {
          "title": "Value",
          "type": "string",
          "writeOnly": true,
          "format": "password"
        }
      },
      "required": [
        "description"
      ],
      "additionalProperties": false
    }
  }
}
